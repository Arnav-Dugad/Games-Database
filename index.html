<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina | Game Encyclopedia</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        paper: '#fcfcfc',
                        ink: '#1a1a1a',
                        subtle: '#f4f4f5',
                        accent: '#2563eb', // Royal Blue
                        secondary: '#64748b'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif']
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'hover': '0 10px 25px -5px rgba(0, 0, 0, 0.1)'
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body {
            background-color: #fcfcfc;
            color: #1a1a1a;
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Smooth Fade In */
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Typography Utilities */
        .font-serif-italic {
            font-family: 'Playfair Display', serif;
            font-style: italic;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Wikipedia API Helper ---
        const WIKI_API = "https://en.wikipedia.org/w/api.php";
        
        // --- Components ---

        const Icon = ({ name, className, weight = "regular" }) => {
            return <i className={`ph ph-${name} ${className}`} style={{ fontWeight: weight }}></i>;
        };

        const Card = ({ title, snippet, pageId, onClick, delay }) => {
            const [imageUrl, setImageUrl] = useState(null);

            useEffect(() => {
                // Fetch thumbnail for this specific card
                const fetchImage = async () => {
                    try {
                        const params = new URLSearchParams({
                            action: "query",
                            prop: "pageimages",
                            pageids: pageId,
                            pithumbsize: 500,
                            format: "json",
                            origin: "*"
                        });
                        const res = await fetch(`${WIKI_API}?${params}`);
                        const data = await res.json();
                        const page = data.query.pages[pageId];
                        if (page.thumbnail) {
                            setImageUrl(page.thumbnail.source);
                        }
                    } catch (e) {
                        console.error("Image fetch failed", e);
                    }
                };
                fetchImage();
            }, [pageId]);

            return (
                <div 
                    className="group cursor-pointer fade-in bg-white rounded-xl overflow-hidden border border-gray-100 hover:border-gray-200 shadow-soft hover:shadow-hover transition-all duration-500 flex flex-col h-full"
                    style={{ animationDelay: `${delay}ms` }}
                    onClick={onClick}
                >
                    <div className="aspect-[16/9] bg-gray-50 overflow-hidden relative">
                        {imageUrl ? (
                            <img 
                                src={imageUrl} 
                                alt={title} 
                                className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 saturate-[0.9] group-hover:saturate-100" 
                            />
                        ) : (
                            <div className="w-full h-full flex items-center justify-center bg-subtle text-gray-300">
                                <Icon name="image" className="text-4xl" />
                            </div>
                        )}
                        <div className="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors duration-300"></div>
                    </div>
                    
                    <div className="p-6 flex flex-col flex-grow">
                        <h3 className="font-serif text-xl font-bold text-ink mb-2 leading-tight group-hover:text-accent transition-colors">
                            {title.replace(/\(video game\)/i, "")}
                        </h3>
                        <div 
                            className="text-sm text-secondary line-clamp-3 leading-relaxed"
                            dangerouslySetInnerHTML={{ __html: snippet }}
                        />
                        <div className="mt-auto pt-4 flex items-center text-xs font-semibold text-accent opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0">
                            READ ENTRY <Icon name="arrow-right" className="ml-1" />
                        </div>
                    </div>
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, title, pageId }) => {
            const [content, setContent] = useState(null);
            const [loading, setLoading] = useState(false);
            const [fullImage, setFullImage] = useState(null);

            useEffect(() => {
                if (isOpen && pageId) {
                    setLoading(true);
                    const fetchDetails = async () => {
                        try {
                            const params = new URLSearchParams({
                                action: "query",
                                prop: "extracts|pageimages",
                                pageids: pageId,
                                exintro: true, // Get introduction only
                                explaintext: false, // Keep HTML for formatting
                                pithumbsize: 1000,
                                format: "json",
                                origin: "*"
                            });
                            
                            const res = await fetch(`${WIKI_API}?${params}`);
                            const data = await res.json();
                            const page = data.query.pages[pageId];
                            
                            setContent(page.extract);
                            if (page.thumbnail) setFullImage(page.thumbnail.source);
                        } catch (e) {
                            console.error(e);
                        } finally {
                            setLoading(false);
                        }
                    };
                    fetchDetails();
                } else {
                    setContent(null);
                    setFullImage(null);
                }
            }, [isOpen, pageId]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-white/80 backdrop-blur-md transition-opacity" onClick={onClose}></div>
                    
                    <div className="relative bg-white w-full max-w-3xl max-h-[90vh] overflow-y-auto rounded-xl shadow-2xl animate-fadeIn border border-gray-100">
                        <button 
                            onClick={onClose}
                            className="absolute top-4 right-4 z-10 w-10 h-10 bg-white/80 backdrop-blur rounded-full flex items-center justify-center hover:bg-white shadow-sm transition-all"
                        >
                            <Icon name="x" className="text-xl" />
                        </button>

                        {loading ? (
                            <div className="h-96 flex items-center justify-center">
                                <div className="animate-spin text-accent"><Icon name="spinner-gap" className="text-3xl" /></div>
                            </div>
                        ) : (
                            <div>
                                {fullImage && (
                                    <div className="w-full h-64 md:h-80 overflow-hidden relative">
                                        <img src={fullImage} className="w-full h-full object-cover" alt={title} />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                                        <h2 className="absolute bottom-6 left-6 md:left-10 text-3xl md:text-5xl font-serif font-bold text-white drop-shadow-md">
                                            {title.replace(/\(video game\)/i, "")}
                                        </h2>
                                    </div>
                                )}
                                
                                {!fullImage && (
                                    <div className="p-8 md:p-10 pb-0">
                                        <h2 className="text-3xl md:text-4xl font-serif font-bold text-ink mb-4">
                                            {title.replace(/\(video game\)/i, "")}
                                        </h2>
                                        <div className="h-1 w-20 bg-accent rounded-full"></div>
                                    </div>
                                )}

                                <div className="p-8 md:p-10 space-y-6">
                                    <div className="prose prose-lg prose-slate max-w-none font-light leading-relaxed text-gray-700">
                                        <div dangerouslySetInnerHTML={{ __html: content }} />
                                    </div>
                                    
                                    <div className="pt-8 border-t border-gray-100 flex justify-end">
                                        <a 
                                            href={`https://en.wikipedia.org/?curid=${pageId}`}
                                            target="_blank"
                                            className="flex items-center gap-2 text-sm font-semibold text-accent hover:text-blue-700 transition-colors"
                                        >
                                            View Full Wikipedia Article <Icon name="arrow-square-out" />
                                        </a>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [query, setQuery] = useState("");
            const [results, setResults] = useState([]);
            const [loading, setLoading] = useState(false);
            const [selectedPage, setSelectedPage] = useState(null);
            const [debouncedQuery, setDebouncedQuery] = useState("");

            // Debounce logic
            useEffect(() => {
                const timer = setTimeout(() => {
                    setDebouncedQuery(query);
                }, 600);
                return () => clearTimeout(timer);
            }, [query]);

            // Initial Load (Curated List)
            useEffect(() => {
                if (!debouncedQuery) {
                    // Load a set of "Classics" initially if search is empty
                    searchWikipedia("The Legend of Zelda video game|Half-Life 2|Portal 2|The Witcher 3|Elden Ring|Super Mario 64");
                } else {
                    searchWikipedia(debouncedQuery);
                }
            }, [debouncedQuery]);

            const searchWikipedia = async (term) => {
                setLoading(true);
                try {
                    // Check if multiple terms separated by pipe (for initial list)
                    const isMulti = term.includes("|");
                    let params;

                    if (isMulti) {
                        // Title Search for curated list
                        params = new URLSearchParams({
                            action: "query",
                            list: "search",
                            srsearch: term.split("|").join(" OR "),
                            srlimit: 12,
                            format: "json",
                            origin: "*"
                        });
                    } else {
                        // General Search
                        // We append "video game" to contextually filter, but users might type it themselves
                        const cleanTerm = term.toLowerCase().includes("game") ? term : `${term} video game`;
                        
                        params = new URLSearchParams({
                            action: "query",
                            list: "search",
                            srsearch: cleanTerm,
                            srlimit: 12,
                            format: "json",
                            origin: "*"
                        });
                    }

                    const res = await fetch(`${WIKI_API}?${params}`);
                    const data = await res.json();
                    
                    if (data.query && data.query.search) {
                        setResults(data.query.search);
                    }
                } catch (e) {
                    console.error("Search failed", e);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen pb-20">
                    
                    {/* Header */}
                    <header className="sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-gray-100">
                        <div className="container mx-auto px-6 py-4 flex flex-col md:flex-row items-center justify-between gap-4">
                            <div className="flex items-center gap-3 select-none" onClick={() => window.location.reload()}>
                                <div className="w-10 h-10 bg-ink text-white rounded-lg flex items-center justify-center shadow-lg">
                                    <Icon name="book-open-text" className="text-2xl" />
                                </div>
                                <h1 className="text-2xl font-serif font-bold tracking-tight text-ink">
                                    Lumina
                                </h1>
                            </div>

                            <div className="w-full md:w-[400px] relative">
                                <Icon name="magnifying-glass" className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-lg" />
                                <input 
                                    type="text" 
                                    placeholder="Search the archives..." 
                                    className="w-full bg-subtle border-none rounded-full py-3 pl-12 pr-4 text-ink placeholder-gray-400 focus:ring-2 focus:ring-accent/20 transition-all outline-none"
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                />
                                {query && (
                                    <button onClick={() => setQuery("")} className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-ink p-1">
                                        <Icon name="x-circle" weight="fill" />
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="container mx-auto px-6 py-10">
                        
                        <div className="mb-8">
                            <h2 className="text-xl font-medium text-gray-400 font-serif italic">
                                {loading ? "Scanning archives..." : query ? `Results for "${query}"` : "Curated Selection"}
                            </h2>
                        </div>

                        {loading && results.length === 0 ? (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                                {[1,2,3,4,5,6].map(n => (
                                    <div key={n} className="h-80 bg-subtle rounded-xl animate-pulse"></div>
                                ))}
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                                {results.map((item, index) => (
                                    <Card 
                                        key={item.pageid}
                                        pageId={item.pageid}
                                        title={item.title}
                                        snippet={item.snippet}
                                        delay={index * 50} // Staggered animation
                                        onClick={() => setSelectedPage({ id: item.pageid, title: item.title })}
                                    />
                                ))}
                            </div>
                        )}

                        {!loading && results.length === 0 && (
                            <div className="flex flex-col items-center justify-center py-20 text-center">
                                <Icon name="magnifying-glass" className="text-6xl text-gray-200 mb-4" />
                                <p className="text-xl text-gray-400 font-serif italic">No records found.</p>
                                <p className="text-gray-400 text-sm mt-2">Try adding "video game" to your search.</p>
                            </div>
                        )}

                    </main>

                    {/* Details Modal */}
                    <Modal 
                        isOpen={!!selectedPage}
                        onClose={() => setSelectedPage(null)}
                        pageId={selectedPage?.id}
                        title={selectedPage?.title || ""}
                    />

                    {/* Footer */}
                    <footer className="border-t border-gray-100 mt-20 py-10">
                        <div className="container mx-auto px-6 text-center text-secondary text-sm">
                            <p className="flex items-center justify-center gap-2 mb-2">
                                <Icon name="copyright" /> 
                                Data provided by <a href="https://wikipedia.org" className="underline hover:text-ink">Wikipedia</a>
                            </p>
                            <p className="opacity-60">Lumina Encyclopedia &copy; 2024</p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>